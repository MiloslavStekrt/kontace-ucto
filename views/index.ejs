<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <title>Vybrat z kontaci...</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-dark text-white my-5">
    <main class="container">
        <h1 class="mb-4 mx-5">Vyberte jednu z operaci...</h1>
        <div class="list-group-item list-group-item-action bg-dark px-0">
            <% operations.map(operation => { %>
                <div class="d-flex">
                    <a href="/opt/<%= operation.id %>" class="text-white rounded-3 my-3 form-control bg-secondary" style="text-decoration: none; border: none;">
                        <h3 class="justify-content-between d-flex">
                            <span class="mx-5 my-1"><%= operation.name.charAt(0).toUpperCase() + operation.name.slice(1) %></span>
                            <div>
                                <small>
                                    <small class="mx-4">@<%= operation.user %></small>
                                </small>
                            </div>
                        </h3>
                    </a>
                    <script>
                        const oper_<%= operation.id %> = async() => {
                            let token = prompt('Vas token...')
                            let response;
                            try {
                                response = await $.post({
                                    url: '/del',
                                    headers: {'Content-Type': 'application/json'},
                                    data: JSON.stringify({
                                        token: token,
                                        id: '<%= operation.id %>'
                                    })
                                });
                                alert('Kontace byla odstranena.');
                                window.location.href="/back"
                            } catch (error) {
                                if(error.status == 403) alert('K odstraneni kontace je treba autoruv klic, ktery zadan nebyl.')
                                if(error.status == 404) alert('Kontace nebyla nalezena')
                            }
                        }
                    </script>
                    <a class="btn btn-danger my-3 ms-2 px-3 fs-3" href='Javascript: oper_<%= operation.id %>()' >&#128501;</a>
                </div>
            <% }) %>
        </div>
        <div class="">
            <a href="/new"  class="text-white btn btn-success form-control p-3 my-2" style="text-decoration: none;">Vytvorit novou</a>
        </div>
    </main>
</body>
</html>