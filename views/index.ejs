<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <meta name="google-site-verification" content="pUpcf4ouWGB3IU0F-07tjWBt9MFJbXH5KGQKmduloxY" />
    <title>Vybrat z kontaci...</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        a {
            text-decoration: none;
        }
    </style>
</head>
<body class="bg-dark text-white my-5">
    <script>
        $.post("/get-code", {
            code: window.localStorage.getItem("code")
        })
    </script>
    <main class="container">
        <h1 class="mb-4 mx-5 d-flex justify-content-between">
            <span>Vyberte jednu z operaci...</span>
            <span>
                <% if (!auth){ %>
                    <a class="btn btn-primary" href="<%= url %>">Přihlasit se</a>
                <% } else { %>
                    <a class="btn btn-info" href="/logout">Odhlasit se</a>
                <%} %>
            </span>
        </h1>
        <div class="list-group-item list-group-item-action bg-dark px-0">
            <% operations.map(operation => { %>
                <div class="d-flex">
                    <a href="/opt/<%= operation.id %>" class="text-white rounded-3 my-3 form-control bg-secondary" style="text-decoration: none; border: none;">
                        <h3 class="justify-content-between d-flex">
                            <span class="mx-5 my-1"><%= operation.name.charAt(0).toUpperCase() + operation.name.slice(1) %></span>
                            <div>
                                <small>
                                    <small class="mx-4"><%= operation.classname ? operation.classname: "bez třídu :(" %></small>
                                </small>
                            </div>
                        </h3>
                    </a>
                    <script>
                        const oper_<%= operation.id %> = async() => {
                            let token = prompt('Vas token...')
                            let response;
                            try {
                                response = await $.post({
                                    url: '/del',
                                    headers: {'Content-Type': 'application/json'},
                                    data: JSON.stringify({
                                        token: token,
                                        id: '<%= operation.id %>'
                                    })
                                });
                                alert('Kontace byla odstranena.');
                                window.location.href="/back"
                            } catch (error) {
                                if(error.status == 403) alert('K odstraneni kontace je treba autoruv klic, ktery zadan nebyl.')
                                if(error.status == 404) alert('Kontace nebyla nalezena')
                            }
                        };
                    </script>
                    <!-- <a class="btn btn-danger my-3 ms-2 px-3 fs-3" href='Javascript: oper_<%= operation.id %>()' >&#128501;</a> -->
                    <% if (typeof operation.author_id != 'undefined' && operation.author_id == code) { %>
                        <a class="btn btn-danger my-3 ms-2 px-3 fs-3" href="/del/<%= operation.id %>">&#128501;</a>
                    <% } %>
                </div>
            <% }) %>
        </div>
        <div class="d-flex">
            <% if(operations.filter(o => typeof o.author_id != 'undefined' && o.author_id == code && (o.classroom == null || o.classroom == "")).length > 0) { %>
                <a href="/back" class="btn btn-warning col p-3 me-4 my-2">Pridelit ke kurzu</a>
            <% } %>
            <a href="/new"  class="text-white btn btn-success col p-3 my-2">Vytvorit novou</a>
        </div>    
    </main>
    <div class="d-flex fixed-bottom text-end px-2 py-4">
        made by Slavek&nbsp;<a href="https://github.com/MiloslavStekrt/kontace-ucto.git">code</a>
    </div>
</body>
</html>